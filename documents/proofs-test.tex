\documentclass[12pt]{article}
\usepackage{bussproofs}
\usepackage{amsmath}
\usepackage{ amssymb }
\usepackage{amsthm}
\usepackage{latexsym}
\usepackage[landscape]{geometry}
\usepackage{color}


\marginparwidth=0pt
\hoffset=-3.5cm
\voffset=-1cm

\newtheorem{thm}{Theorem}[section]

% most others are numbered together with theorems
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{exmp}[thm]{Example}
%%
% just an example of what will happen if you skip the [thm]
% part -- conjectures will be numbered consecutively
\newtheorem{conj}{Conjecture}
\newtheorem{prob}{Problem}
\newtheorem{claim}{Claim}

\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{property}{Property}[section]
\theoremstyle{remark}
\newtheorem{rem}{Remark}[section]
\newtheorem{notation}{Notation}


\newcommand{\clause}[1]{ \lfloor{#1} \rfloor}
\begin{document}
\section{Local Redundancy}
We first consider an example first posed by Postan:
\begin{prooftree}
\AxiomC{$L_2$: $P(A)$}
\AxiomC{$\eta_2$: $\neg P(x)$, $\neg Q(x, B)$}
\BinaryInfC{$\neg Q(x,  B)$}
\AxiomC{$\eta_1$: $\neg P(z)$, $Q(z,y)$}
\BinaryInfC{$\neg P(z)$}
\AxiomC{$L_1$: $P(x)$}
\BinaryInfC{$\bot$}
\end{prooftree}
Which is locally redundant; see the compressed version in his document.

\section{``Example 2''}
We consider example 2, from the LU/RPI paper, modified for first order predicates in a trivial way:
\begin{prooftree}
\def\fCenter{\mbox{\ $\vdash$\ }}

\AxiomC{$\eta_1$: $\neg P(A)$}
\AxiomC{$\eta_3$: $P(A),Q(B)$}
\BinaryInfC{$\eta_4$: $Q(B)$}
\AxiomC{$\eta_2$: $P(A), R(C), \neg Q(B)$}
\BinaryInfC{$\eta_5$: $P(A), R(C)$}
\AxiomC{$\eta_1$: $\neg P(A)$}
\BinaryInfC{$\eta_6$: $R(C)$}

\AxiomC{$\eta_4$: $Q(B)$}
\AxiomC{$\eta_7$: $P(A), \neg Q(B), \neg R(C)$}
\BinaryInfC{$\eta_8$: $P(A), \neg R(C)$}
\AxiomC{$\eta_1$: $\neg P(A)$}
\BinaryInfC{$\eta_9$: $\neg R(C)$}

\BinaryInfC{$\bot$}
\end{prooftree}

\subsection{Lower Units}
Proceeds exactly the same as in the paper.\\
{\bf TODO:} show exact steps? \\

\subsection{RecyclePivots}
Again, proceeds like in the paper. 

\section{Lower Units}
\subsection{Research Notes}
First, I consider the proofs 1-5 that were provided by Bruno on the Skeptik dev mailing list. In order to be explicit, I outline the case of compression from proof 1 to proof 2:
\begin{itemize}
\item Lower $P(X)$ so that the terms using it were resolved against each other instead of with $P(X)$
\item Contract (trivially?); the unifier resulted in the duplicated terms
\item Resolve the contracted formula against the lowered unit, $P(X)$
\end{itemize}

The result is a trade of a resolution for a contraction, which is more compact (when we consider compactness as a count of the number of resolution rules).

In order to generalize, I think the best place to start was see under what conditions we can in fact make this contraction. It should not be required that contraction results in duplicated formulas; indeed, as long as a contraction is possible this seems to work. So in particular, I conjecture that we should lower a unit formula if and only if for all formulas which would be resolved against the unit clause of interest are pair-wise unifiable (disregarding the remainder of their premises), and unifiable with the unit. Further, the unit must be the most general form of the formula, as the following shows:

\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{\e$P(y,x)$}
\AxiomC{$P(A,x)$ \e $Q(A),R(B)$}
\BinaryInfC{\e $Q(y), R(B)$}
\AxiomC{$Q(y)$ \e $Q(x)$}
\BinaryInfC{\e $R(B), Q(x)$}

\AxiomC{$Q(A), P(y,A)$\e}
\AxiomC{\e$P(y,x)$}
\BinaryInfC{$Q(x)$\e}

\BinaryInfC{\e$R(B)$}
\AxiomC{$R(B)$\e}

\BinaryInfC{$\bot$}
\end{prooftree}

but if we delay the resolution with $P(y,x)$ we get

\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{$P(A,x)$\e $Q(A),R(B)$}
\AxiomC{$Q(y)$ \e$Q(x)$}
\BinaryInfC{$P(y,x)$\e$Q(x),R(B)$}

\AxiomC{$Q(A), P(y,A)$\e}
\BinaryInfC{$P(y,x), P(x,y)$\e $R(B)$}
\AxiomC{$R(B)$\e}
\BinaryInfC{$P(y,x),P(y,A)$\e}
\AxiomC{\e $P(y,x)$}
\BinaryInfC{$P(y,x)$}
\AxiomC{\e $P(y,x)$}
\BinaryInfC{$\bot$}
\end{prooftree}

and now we actually the same number of resolution rules. No, we can still use a contraction, and reduce the proof.

The requirement for being pairwise unifiable is also seen in proof 1 and 2, but further, this is lacking the case of proof 3: $P(a)$ and $P(b)$ is not unifiable, and thus proof 5 is not actually compressed. But if $P(b)$ had been $P(B)$, then we would have been fine. It also fails in the following example:

\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{\e $P(X)$}
\AxiomC{$P(a)$\e$Q(Y),R(Z)$}
\BinaryInfC{\e$Q(Y),R(Z)$}
\AxiomC{$R(X),P(b)$\e $S(Y)$}
\BinaryInfC{$P(b)$\e $S(Y),Q(Y)$}
\AxiomC{$S(Y), Q(Y)$\e}
\BinaryInfC{$P(b)$\e}
\AxiomC{\e $P(X)$}
\BinaryInfC{$\bot$}
\end{prooftree}

which is the 'potentially' globally reduction example from the original lower units paper.\\


\newpage
\subsection{Results}
Let $\clause{x}$ denote a clause consisting of the formula $x$.

\begin{thm}
Let $S$ be the set of premises being resolved against a unit clause $u$. Then $u$ can be lowered if, for every distinct $\eta_1,\eta_2 \in S$, $\eta_1$ and $\eta_2$ are unifiable.
\end{thm}

\begin{proof}
We proceed by induction. Base case: $|S|=1$. In this case, the unit $\clause{u}$ is only involved in exactly one resolution; let $\clause{\eta}$ be the premise resolved against $\clause{u}$ so that we have $P=\phi[\phi_1[\eta \odot_{\sigma} u] \odot_{\sigma_r}  r]$. Note that $\clause{\eta}$ contains $\clause{\overline{u}'}$, a negated version of $\clause{u}$, which would be resolved out in conclusion of $\phi$, and let $\sigma_u$ be a unifier of $\clause{\overline{u}'}$ and $\clause{u}$. Consider instead $P'=\phi[\phi']$, the proof obtained by replacing the resolution $\phi_1[\eta \odot_{\sigma} u] \odot_{\sigma_r}  r$ with just $\phi' = \eta \odot_{\sigma_{r'}} r$ and maintaining the subsequent subproof of $\phi$. Note that all nodes of $\phi'$ contain $\clause{\overline{u}'}$. In particular, the final node in the proof $P'$ is $\clause{\overline{u}'}$ instead of $\clause{\bot}$. But then we can resolve against $u$ using $\sigma_u$ to complete the proof.

Assume the result holds for all $|S|\le n$, and consider $|S|=n+1$. Assume that $S$ is defined as above, and is pairwise unifiable. Order the elements from the top of the proof to the bottom (and break ties left-right), so that $\clause{\eta_1}$ is the top-left-most premise resolved against $\clause{u}$. In particular, $\clause{\eta_1}$ contains $\clause{\overline{u}_1'}$, and we have that $P=\phi[\phi_1[\eta_1 \odot_{\sigma_1} u] \odot_{\sigma_{r_1}} r_1]$. Consider instead $\phi[\phi_1']$, the proof obtained by replacing the resolution $\phi_1[\eta_1 \odot_{\sigma_1} u] \odot_{\sigma_{r_1}} r_1$ with just $\phi_1' = \eta_1 \odot_{\sigma_{r_1'}} r_1$ and maintaining the subproof of $\phi$. Note that all nodes of $\phi_1'$ contain $\clause{\overline{u}_1'}$ still. In particular, the final node in the proof is $\clause{\overline{u}_1'}$ instead of $\clause{\bot}$.  

Consider $S'=S\setminus\clause{\eta_1}$: since $|S|=n+1>1$, $|S'| = |S|-1 \le n$. Apply the induction hypothesis to the premises in $S'$ to get a  resolution $\phi_2[\eta_2 \odot_{\sigma_2} u] \odot_{\sigma_{r_2}} r_2$ (where $\clause{\eta_2}$ contains $\clause{\overline{u}_2'}$);  we can construct $\phi_2' = \eta_2 \odot_{\sigma_{r_2'}} r_2$. Consider  $\phi[\phi_2']$ and follow an argument similar to that for $\clause{\eta_1}$; the final proof node has $\clause{\overline{u}_1'} \cup \clause{\overline{u}_2'}$ instead of $\clause{\overline{u}_1'}$ where $\clause{\overline{u}_2'}$ is the result of the lower, after contraction, but before the final resolution with $u$, applied by the induction hypothesis.  By assumption, $\clause{\overline{u}_1'}$ and $\clause{\overline{u}_2'}$ are pair-wise unifiable by some unifier $\sigma_{1,2}$. We can therefore contract $\sigma_{1,2}(\clause{\overline{u}_1'} \cup \clause{\overline{u}_2'})$ and call the result $\clause{\eta_{1,2}}$. Now $\clause{\eta_{1,2}}$ and $\clause{u}$ must be unifiable by assumption with some unifier $\sigma_u$, so we can replace the last node in the proof with $\eta_{1,2}\odot_{\sigma_u} u$ to complete the proof.
\end{proof}

\newpage
\section{Recycle Pivots}
\subsection{Research Notes}

From the looks of some toy examples, I again conjecture we can recycle pivots when the formulas being moved are pairwise unifiable. Example from the video, trivially made first-order (should there be a contraction at the ``c: "?):

\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{\e $A(X)C(Y)D(Z)$}
\AxiomC{$D(Z)$ \e $A(X)C(Y)$}
\BinaryInfC{\e $A(X)C(Y)$}
\AxiomC{$A(X)$ \e $C(Y)$}
\BinaryInfC{c:  \e $C(Y)$}

\AxiomC{$C(Y)$\e}
\AxiomC{$D(Z)$ \e $C(Y)$}
\BinaryInfC{$D(Z)$\e}
\AxiomC{$A(X) C(Y)$ \e $D(Z)$}
\BinaryInfC{$A(X)C(Y)$\e}

\BinaryInfC{$A(X)$\e}

\AxiomC{\e $A(X)$}

\BinaryInfC{$\bot$}

\end{prooftree}

Which is, after the first (bottom-up) traversal:

\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{{\color{red} \e $A(X)C(Y)D(Z)$ }}
\AxiomC{{\color{red}$D(Z)$ \e $A(X)C(Y)$}}
\BinaryInfC{{\color{red}\e $A(X)C(Y)$}}
\AxiomC{$A(X)$ \e $C(Y)$}
\RightLabel{\scriptsize $A(X)$}
\BinaryInfC{c:  \e $C(Y)$ $\{A(X)\e C(Y) \}$}

\AxiomC{$C(Y)$\e}
\AxiomC{{\color{red}$D(Z)$ \e $C(Y)$ }}
\RightLabel{\scriptsize $C(Y)$}
\BinaryInfC{$D(Z)$\e $\{A(X)C(Y)D(Z)\e \}$}
\AxiomC{$A(X) C(Y)$ \e $D(Z)$}
\RightLabel{\scriptsize $D(Z)$}
\BinaryInfC{$A(X)C(Y)$\e $\{A(X)C(Y)\e \}$}

\RightLabel{\scriptsize $C(Y)$}
\BinaryInfC{$A(X)$\e $\{A(X)\e\}$}

\AxiomC{\e $A(X)$}
\LeftLabel{\scriptsize $A(X)$}
\BinaryInfC{$\bot$ $\{ \}$} 

\end{prooftree}

\def\e{\mbox{\ $\vdash$\ }}

Now we start the second (top-down) traversal. We replace $D(Z)$ with $C(Y) \e$ since $ C(Y) \e$ is in $D(Z)$'s safe formulas, and we replace with the left parent of $D(Z)$ since that is the one that contains the safe formula $C(Y) \e$.

\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{{\color{red} \e $A(X)C(Y)D(Z)$ }}
\AxiomC{{\color{red}$D(Z)$ \e $A(X)C(Y)$}}
\BinaryInfC{{\color{red}\e $A(X)C(Y)$}}
\AxiomC{$A(X)$ \e $C(Y)$}
%\RightLabel{\scriptsize $A(X)$}
\BinaryInfC{c:  \e $C(Y)$ $\{A(X)\e C(Y) \}$}

\AxiomC{$C(Y)$\e}
\AxiomC{$A(X) C(Y)$ \e $D(Z)$}
%\RightLabel{\scriptsize $D(Z)$}
\BinaryInfC{$A(X)C(Y)$\e $\{A(X)C(Y)\e \}$}

%\RightLabel{\scriptsize $C(Y)$}
\BinaryInfC{$A(X)$\e $\{A(X)\e\}$}

\AxiomC{\e $A(X)$}
%\LeftLabel{\scriptsize $A(X)$}
\BinaryInfC{$\bot$ $\{ \}$} 

\end{prooftree}

Now we lower $C(Y) \e$ again, because it is also in $A(X)C(Y)\e$'s safe formulas, and we pick the left because the right parent might have unsafe formulas (e.g. $\e D(Z)$), but the left has only safe formulas.


\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
\AxiomC{{\color{red} \e $A(X)C(Y)D(Z)$ }}
\AxiomC{{\color{red}$D(Z)$ \e $A(X)C(Y)$}}
\BinaryInfC{{\color{red}\e $A(X)C(Y)$}}
\AxiomC{$A(X)$ \e $C(Y)$}
%\RightLabel{\scriptsize $A(X)$}
\BinaryInfC{c:  \e $C(Y)$ $\{A(X)\e C(Y) \}$}

\AxiomC{$C(Y)$\e}
%\AxiomC{$A(X) C(Y)$ \e $D(Z)$}
%\RightLabel{\scriptsize $D(Z)$}
%\BinaryInfC{$A(X)C(Y)$\e $\{A(X)C(Y)\e \}$}

%\RightLabel{\scriptsize $C(Y)$}
\BinaryInfC{$A(X)$\e $\{A(X)\e\}$}

\AxiomC{\e $A(X)$}
%\LeftLabel{\scriptsize $A(X)$}
\BinaryInfC{$\bot$ $\{ \}$} 

\end{prooftree}

Now we need to deal with the last remaining broken proof section (what is left in red). Since $A(X) \e C(Y)$ is safe with respect to the line under it, we lower it:


\begin{prooftree}
\def\e{\mbox{\ $\vdash$\ }}
%\AxiomC{{\color{red} \e $A(X)C(Y)D(Z)$ }}
%\AxiomC{{\color{red}$D(Z)$ \e $A(X)C(Y)$}}
%\BinaryInfC{{\color{red}\e $A(X)C(Y)$}}
\AxiomC{$A(X)$ \e $C(Y)$}
%\RightLabel{\scriptsize $A(X)$}
%\BinaryInfC{c:  \e $C(Y)$ $\{A(X)\e C(Y) \}$}

\AxiomC{$C(Y)$\e}
%\AxiomC{$A(X) C(Y)$ \e $D(Z)$}
%\RightLabel{\scriptsize $D(Z)$}
%\BinaryInfC{$A(X)C(Y)$\e $\{A(X)C(Y)\e \}$}

%\RightLabel{\scriptsize $C(Y)$}
\BinaryInfC{$A(X)$\e }

\AxiomC{\e $A(X)$}
%\LeftLabel{\scriptsize $A(X)$}
\BinaryInfC{$\bot$ } 

\end{prooftree}

And we have the desired shorter proof. So looking at this, my first conjecture is as follows:

\begin{conj}
\label{conj: recycle-cond}
A pivot can be recycled if, for every safe formula collected, all formula containing it that are lowered when attempting to regularize with that safe formula, is unifiable with the safe formula.
\end{conj}

For example, the $C(Y)\e$ we lower first in the second traversal, must be unifiable with the $C(Y)\e$ we collected going up on the first traversal.

\end{document}